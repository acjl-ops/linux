From: Thomas Gleixner <tglx@linutronix.de>
Date: Fri, 17 Sep 2021 12:56:34 +0200
Subject: [PATCH] sched: Add preempt_disable_rt()

RT needs a few preempt_disable/enable points which are not necessary
otherwise. Implement variants to avoid #ifdeffery.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
---
 include/linux/preempt.h |    8 ++++++++
 1 file changed, 8 insertions(+)

--- a/include/linux/preempt.h
+++ b/include/linux/preempt.h
@@ -283,6 +283,14 @@ do { \
 		set_preempt_need_resched(); \
 } while (0)
 
+#ifdef CONFIG_PREEMPT_RT
+# define preempt_disable_rt()		preempt_disable()
+# define preempt_enable_rt()		preempt_enable()
+#else
+# define preempt_disable_rt()		barrier()
+# define preempt_enable_rt()		barrier()
+#endif
+
 #ifdef CONFIG_PREEMPT_NOTIFIERS
 
 struct preempt_notifier;
